# Система управления клиентами (CRM)

Веб-система для учёта клиентов с динамической структурой данных, балансом, фотографиями и административной панелью. Разработана по ТЗ на PHP (Laravel 10).

## Возможности

- **Клиенты**: имя, фамилия, дата рождения, email, телефон, дата регистрации, баланс, статус, фото
- **Мягкое удаление** клиентов
- **Пользовательские поля** (текст, число, дата, выпадающий список, чекбокс, текстовая область, файл)
- **Баланс**: пополнение/списание, история операций
- **Фотографии**: загрузка (JPG, PNG, WebP до 5 МБ)
- **Админ-панель**: клиенты, настройка полей, пользователи, настройки, журнал активности
- **Публичный сайт**: список клиентов с фильтрами и пагинацией (20 на страницу), карточка клиента
- **REST API**: `GET /api/clients`, `GET /api/clients/{id}`

## Требования

- PHP 8.1+
- MySQL 8.0+ или PostgreSQL 13+
- Composer
- Node.js/npm (опционально, для сборки ассетов)

## Установка

1. Клонируйте репозиторий и перейдите в каталог проекта:
   ```bash
   cd client-management-crm
   ```

2. Установите зависимости:
   ```bash
   composer install
   ```

3. Настройте окружение:
   ```bash
   cp .env.example .env
   php artisan key:generate
   ```
   Отредактируйте `.env`: укажите `DB_DATABASE`, `DB_USERNAME`, `DB_PASSWORD`, при необходимости `APP_URL`.

4. Выполните миграции:
   ```bash
   php artisan migrate
   ```

5. Создайте символическую ссылку для хранилища файлов:
   ```bash
   php artisan storage:link
   ```

6. (Опционально) Создайте первого администратора:
   ```bash
   php artisan tinker
   >>> \App\Models\User::create(['name' => 'Admin', 'email' => 'admin@example.com', 'password' => bcrypt('password'), 'role' => 'super_admin']);
   ```

7. Настройте веб-сервер (Apache/Nginx) на каталог `public/` или запустите встроенный сервер:
   ```bash
   php artisan serve
   ```
   Откройте в браузере: главная — http://localhost:8000 , админка — http://localhost:8000/admin/login .

## Структура

- `app/Models/` — Client, CustomField, BalanceTransaction, User, Setting, ActivityLog
- `app/Http/Controllers/Admin/` — CRUD клиентов, поля, пользователи, настройки
- `app/Http/Controllers/Frontend/` — публичный список и карточка клиента
- `app/Http/Controllers/Api/` — REST API
- `database/migrations/` — миграции БД
- `resources/views/admin/` — шаблоны админ-панели
- `resources/views/frontend/` — шаблоны публичного сайта

## Безопасность

- CSRF-токены для веб-форм (API в исключениях при использовании токенов)
- Валидация и санитизация входных данных
- Пароли хранятся с bcrypt
- Рекомендуется развертывание по HTTPS

## Документация по ТЗ

Соответствие разделам ТЗ:

- **3.1 Модуль клиентов** — реализован (CRUD, баланс, фото, поиск)
- **3.2 Административная панель** — управление полями, пользователями, настройками, активность
- **3.3 Фронтенд** — список с пагинацией (20), сортировка, фильтры, детальная страница
- **4.1 Backend** — PHP 8.1, Laravel 10, MVC, REST API
- **4.2 БД** — динамическая схема (EAV для пользовательских полей), индексы
- **4.4 Безопасность** — валидация, CSRF, хеширование паролей

Лицензия: MIT.
